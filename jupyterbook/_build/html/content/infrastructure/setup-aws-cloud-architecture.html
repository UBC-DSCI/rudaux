

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>2. Set up AWS cloud architecture</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/mystnb.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../../_static/rudaux_jupiter.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3. Setting up Ansible on your local machine" href="build-jupyterhubs-w-ansible.html" />
    <link rel="prev" title="1. Inventory list" href="inventory-list.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/rudaux_jupiter.jpg" class="logo" alt="logo">
  
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <p class="caption">
 <span class="caption-text">
  Infrastructure
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="inventory-list.html">
   1. Inventory list
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   2. Set up AWS cloud architecture
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="build-jupyterhubs-w-ansible.html">
   3. Setting up Ansible on your local machine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="build-jupyterhubs-w-ansible.html#add-the-variables-specific-to-your-course">
   4. Add the variables specific to your course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="build-jupyterhubs-w-ansible.html#build-the-jupyterhubs-using-ansible">
   5. Build the JupyterHubs using Ansible
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="add-jupyterhub-as-app-in-canvas.html">
   6. Add JupyterHub as an App on Canvas
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Assignments
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../assignments/setting-up-assignments.html">
   1. Setting up Assignments on Canvas
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Running the course
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../course/running-the-course.html">
   1. Running the course
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/content/infrastructure/setup-aws-cloud-architecture.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/UBC-DSCI/rudaux"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/UBC-DSCI/rudaux/issues/new?title=Issue%20on%20page%20%2Fcontent/infrastructure/setup-aws-cloud-architecture.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            
        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="set-up-aws-cloud-architecture">
<h1><span class="section-number">2. </span>Set up AWS cloud architecture<a class="headerlink" href="#set-up-aws-cloud-architecture" title="Permalink to this headline">¶</a></h1>
<ol>
<li><p>Log into the <a class="reference external" href="https://aws.amazon.com/console/">AWS Management console</a> and search for EC2 in the AWS services search bar:</p>
 <br>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ec2-1.png"><img alt="ec2-1" src="../../_images/ec2-1.png" style="width: 500px;" /></a>
</div>
 <br>
</li>
<li><p>Scroll down and click on the orange “Launch Instance” button:</p>
 <br>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ec2-2.png"><img alt="ec2-2" src="../../_images/ec2-2.png" style="width: 500px;" /></a>
</div>
 <br>
</li>
<li><p>Search for the Centos 7.8 Community Amazon machine image (AMI) that has the id <code class="docutils literal notranslate"><span class="pre">ami-0252eebc56636a56b</span></code>:</p>
 <br>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ec2-3.png"><img alt="ec2-3" src="../../_images/ec2-3.png" style="width: 500px;" /></a>
</div>
 <br>
<p>and select it:</p>
 <br>  
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ec2-4.png"><img alt="ec2-4" src="../../_images/ec2-4.png" style="width: 500px;" /></a>
</div>
 <br>    
</li>
<li><p>Select an instance type (we use a m5.4xlarge for ~ 200 students) and click “Next: Configure Instance Details”:</p>
 <br>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ec2-5.png"><img alt="ec2-5" src="../../_images/ec2-5.png" style="width: 500px;" /></a>
</div>
 <br>  
</li>
<li><p>Leave these settings as is, and click on “Next: Add Storage”:</p>
 <br>  
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ec2-6.png"><img alt="ec2-6" src="../../_images/ec2-6.png" style="width: 500px;" /></a>
</div>
 <br>  
</li>
<li><p>Click the “Add New Volume” button twice to add two additional EBS volumes (one for the students’ persistent filesystems, and one for Docker). Edit the sizes to be 30, 1024 and 128 for the root, students’ persistent filesystems, and Docker volumes, respectively. Click the “Next: Add Tags” button:</p>
 <br>  
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ec2-7.png"><img alt="ec2-7" src="../../_images/ec2-7.png" style="width: 500px;" /></a>
</div>
 <br>  
</li>
<li><p>Add a key and value pair to easily identify the machine later on your EC2 console (we used the key “Course” and value “workflows” here, but you can choose whatever is meaningful to you). Click the “Next: Configure Security Group” button:</p>
 <br>  
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ec2-8.png"><img alt="ec2-8" src="../../_images/ec2-8.png" style="width: 500px;" /></a>
</div>
 <br>  
</li>
<li><p>Click the “Add Rule” button three times to add three additional security groups. Choose the one each of the following types: HTTP, HTTPS and All ICMP - IPv4. For the All ICMP - IPv4 security group, edit the value for the Source to be Custom and 0.0.0.0/0. Click the blue “Review and Launch” button:</p>
 <br>  
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ec2-9.png"><img alt="ec2-9" src="../../_images/ec2-9.png" style="width: 500px;" /></a>
</div>
 <br>  
</li>
<li><p>Review your settings, and if satisfied, click the blue “Launch” button:</p>
 <br>  
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ec2-10.png"><img alt="ec2-10" src="../../_images/ec2-10.png" style="width: 500px;" /></a>
</div>
 <br>  
</li>
<li><p>Choose “Create a new key pair” and create a “Key pair name” (here we used jupyterhub). Click “Download Key Pair” and then the blue “Launch Instance” button:</p>
 <br>  
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ec2-11.png"><img alt="ec2-11" src="../../_images/ec2-11.png" style="width: 500px;" /></a>
</div>
 <br>  
<p>Save the key pair somewhere intentional on your laptop (e.g., <code class="docutils literal notranslate"><span class="pre">~/.ssh/</span></code>) and then type the following to update the permissions of the key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="mi">400</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">jupyterhub</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
</li>
<li><p>If successful, you should see this screen:</p>
 <br>  
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ec2-12.png"><img alt="ec2-12" src="../../_images/ec2-12.png" style="width: 500px;" /></a>
</div>
 <br>  
</li>
<li><p>Go back to the EC2 Dashboard (reminder: you can get there via searching for EC2 in the AWS services search bar) and click on the “Running instances” link:</p>
 <br>  
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ec2-13.png"><img alt="ec2-13" src="../../_images/ec2-13.png" style="width: 500px;" /></a>
</div>
 <br>  
</li>
<li><p>Select the instance you just launched and under the “Description” tab note (and record somewhere for future reference) the Public DNS (IPv4) value (which will be used to ssh into the instance) and the IPv4 Public IP address (which will be used by ansible and for mapping your custom domain name to the server):</p>
 <br>  
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ec2-14.png"><img alt="ec2-14" src="../../_images/ec2-14.png" style="width: 500px;" /></a>
</div>
 <br>  
</li>
<li><p>Add the Ansible machine’s (e.g., your laptop’s) public key to <code class="docutils literal notranslate"><span class="pre">~/.ssh/authorized_keys</span></code> on the EC2 instances. To do this you need to ssh into the EC2 instance using the private key you downloaded from Amazon earlier (<code class="docutils literal notranslate"><span class="pre">jupyterhub.pem</span></code> in this example):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="o">-</span><span class="n">i</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">jupyterhub</span><span class="o">.</span><span class="n">pem</span> <span class="n">centos</span><span class="nd">@ec2</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">96</span><span class="o">-</span><span class="mi">44</span><span class="o">-</span><span class="mf">97.</span><span class="n">ca</span><span class="o">-</span><span class="n">central</span><span class="o">-</span><span class="mf">1.</span><span class="n">compute</span><span class="o">.</span><span class="n">amazonaws</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p>And then use The UNIX vi editor to add your public key the <code class="docutils literal notranslate"><span class="pre">~/.ssh/authorized_keys</span></code> file. To do this type the following to open vi:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vi</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">authorized_keys</span>
</pre></div>
</div>
<p>Then press <code class="docutils literal notranslate"><span class="pre">i</span></code> to enter insert mode and paste your key using your OS’s paste keyboard shortcut. Then press <code class="docutils literal notranslate"><span class="pre">ESC</span></code> + <code class="docutils literal notranslate"><span class="pre">w</span></code> + <code class="docutils literal notranslate"><span class="pre">q</span></code> to write the file and exit. Now you are are ready to move onto using Ansible to build the student JupyerHub.</p>
</li>
</ol>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content/infrastructure"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="inventory-list.html" title="previous page"><span class="section-number">1. </span>Inventory list</a>
    <a class='right-next' id="next-link" href="build-jupyterhubs-w-ansible.html" title="next page"><span class="section-number">3. </span>Setting up Ansible on your local machine</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Tiffany Timbers<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../_static/js/index.js"></script>
    
  </body>
</html>